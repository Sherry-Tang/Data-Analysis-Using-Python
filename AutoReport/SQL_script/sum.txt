select '合计'  as '各区（县、市）',E.区域承保设备 as '承保起重机械（台）',
A.在保总包单位 as '投保企业（家）' ,B.在建项目 as '承保建筑工地项目（个）',C.新增总包单位 as '新增投保企业（家）',D.当季新项目 as '新增建筑工地项目（个）'from
( 
select 1 编号,count(distinct e.EnterpriseName) 在保总包单位
from HoistingPolicy hois 
left join Enterprise e on hois.EnterpriseId = e.Id
where hois.EndDate>= @EndDate and hois.BeginDate< @EndDate and hois.IsDeleted=0 
and hois.IsPolicyFileUploaded=1 and CheckState='PASS'
and( hois.IsRemoved=0 or hois.IsRemoved is null or (IsRemoved=1 and RemoveTime>= @EndDate))
) A 
full join
(
select 1 编号, count(distinct ProjectName) 在建项目
from HoistingPolicy hois 
where hois.EndDate>= @EndDate and hois.BeginDate< @EndDate and hois.IsDeleted=0 
and hois.IsPolicyFileUploaded=1 and CheckState='PASS'
and( hois.IsRemoved=0 or hois.IsRemoved is null or (IsRemoved=1 and RemoveTime>= EndDate))
) B on A.编号=B.编号 
full join
(
select 1 编号, count(distinct e.EnterpriseName)新增总包单位 
from HoistingPolicy a left join Enterprise e on a.EnterpriseId = e.Id
where a.ProjectName not in 
(select ProjectName from HoistingPolicy where BeginDate<@BeginDate and a.IsDeleted=0 and a.IsPolicyFileUploaded=1 and a.CheckState='PASS')
and BeginDate>=@BeginDate and BeginDate<@EndDate and a.IsDeleted=0 and a.IsPolicyFileUploaded=1 and a.CheckState='PASS'
) C on A.编号=C.编号 
full join
(
select 1 编号, count(DISTINCT ProjectName)当季新项目 
from HoistingPolicy where ProjectName not in 
(select ProjectName from HoistingPolicy where BeginDate<@BeginDate and IsDeleted=0 and IsPolicyFileUploaded=1 and CheckState='PASS')
and BeginDate>=@BeginDate and BeginDate<@EndDate and IsDeleted=0 and IsPolicyFileUploaded=1 and CheckState='PASS'
) D on A.编号=D.编号 
full join
(
select 1 编号,count(*)区域承保设备
from HoistingPolicy hois 
where hois.IsDeleted=0 and hois.IsPolicyFileUploaded=1 and CheckState='PASS' and( hois.IsRemoved=0 or hois.IsRemoved is null or (IsRemoved=1 and RemoveTime>=@EndDate))
and hois.EndDate>=@EndDate and hois.BeginDate<@EndDate
) E on A.编号=E.编号