CREATE VIEW 检查截点_2 AS 
SELECT H.Id AS 保单Id,
	   ROW_NUMBER() OVER (PARTITION BY H.Id ORDER BY InspectionCheckTime2 DESC ) rk_台数,
	   D.InspectionResult AS 小项风险标识
  FROM HoistingPolicy AS H
LEFT JOIN TisInspectionInfo AS I ON I.HoistingPolicyId=H.Id
LEFT JOIN TisInspectionDetailInfo AS D ON D.TisInspectionInfoId=I.Id
LEFT JOIN Correct.dbo.Install AS T on T.SystemName=H.InstallationEnterprise
LEFT JOIN Correct.dbo.Payload AS P on P.Specification=H.Specification
WHERE (D.IsDeleted=0 or D.IsDeleted=Null) AND D.InspectionCheckState='PASS2' AND D.InspectionResult IS NOT NULL AND D.ItemType='检测' AND D.InspectionCheckTime2<@EndDate 
   AND H.IsDeleted=0 AND H.IsPolicyFileUploaded=1 AND H.CheckState='PASS';